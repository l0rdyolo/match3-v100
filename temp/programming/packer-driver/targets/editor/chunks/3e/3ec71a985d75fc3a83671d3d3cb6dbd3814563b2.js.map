{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/SooLib/Optimization/ObjectPooling.ts"],"names":["ObjectPooling","size","objectQueue","length","constructor","createObject","initObject","recycleObject","values","initialSize","maxSize","onObjectAcquired","Error","value","push","get","obj","shift","forEach","callback","release","indexOf","addOnObjectAcquiredListener","removeOnObjectAcquiredListener","filter","listener","clear"],"mappings":";;;kEAOaA,a;;;;;;;;;;;;;;;;;+BAAAA,a,GAAN,MAAMA,aAAN,CAA0E;AASrE,YAAJC,IAAI,GAAW;AACf,iBAAO,KAAKC,WAAL,CAAiBC,MAAxB;AACH;;AAEDC,QAAAA,WAAW,CACPC,YADO,EAEPC,UAFO,EAGPC,aAHO,EAIPC,MAJO,EAKPC,WAAmB,GAAG,EALf,EAMPC,OAAe,GAAG,IANX,EAOT;AAAA,eAnBML,YAmBN;AAAA,eAlBMC,UAkBN;AAAA,eAjBMC,aAiBN;AAAA,eAfMI,gBAeN,GAf+C,EAe/C;AAAA,eAdMT,WAcN,GAdyB,EAczB;AAAA,eAZMQ,OAYN;;AACE,cAAI,CAACL,YAAL,EAAmB;AACf,kBAAM,IAAIO,KAAJ,CAAU,iCAAV,CAAN;AACH;;AAED,cAAIH,WAAW,GAAG,CAAlB,EAAqB;AACjB,kBAAM,IAAIG,KAAJ,CAAU,oCAAV,CAAN;AACH;;AAED,eAAKP,YAAL,GAAoBA,YAApB;AACA,eAAKC,UAAL,GAAkBA,UAAlB;AACA,eAAKC,aAAL,GAAqBA,aAArB;AACA,eAAKG,OAAL,GAAeA,OAAf;;AAEA,cAAIF,MAAJ,EAAY;AACR,iBAAK,IAAIK,KAAT,IAAkBL,MAAlB,EAA0B;AACtB,mBAAKN,WAAL,CAAiBY,IAAjB,CAAsBD,KAAtB;AACH;AACJ;AACJ;;AAEME,QAAAA,GAAG,GAAM;AAAA;;AACZ,cAAIC,GAAJ;;AAEA,cAAI,KAAKd,WAAL,CAAiBC,MAAjB,KAA4B,CAAhC,EAAmC;AAC/Ba,YAAAA,GAAG,GAAG,KAAKX,YAAL,EAAN;AACH,WAFD,MAEO;AACHW,YAAAA,GAAG,GAAG,KAAKd,WAAL,CAAiBe,KAAjB,EAAN;AACH;;AAED,mCAAKX,UAAL,iDAAkBU,GAAlB;AACA,eAAKL,gBAAL,CAAsBO,OAAtB,CAA8BC,QAAQ,IAAIA,QAAQ,CAACH,GAAD,CAAlD;AACA,iBAAOA,GAAP;AACH;;AAEMI,QAAAA,OAAO,CAACJ,GAAD,EAAe;AAAA;;AACzB,cAAI,CAACA,GAAL,EAAU;AACN,kBAAM,IAAIJ,KAAJ,CAAU,uBAAV,CAAN;AACH;;AAED,cAAI,KAAKV,WAAL,CAAiBmB,OAAjB,CAAyBL,GAAzB,MAAkC,CAAC,CAAvC,EAA0C;AACtC,kBAAM,IAAIJ,KAAJ,CAAU,wFAAV,CAAN;AACH;;AAED,cAAI,KAAKX,IAAL,GAAY,KAAKS,OAArB,EAA8B;AAC1B,iBAAKR,WAAL,CAAiBY,IAAjB,CAAsBE,GAAtB;AACH;;AAED,sCAAKT,aAAL,oDAAqBS,GAArB;AACH;;AAEMM,QAAAA,2BAA2B,CAACH,QAAD,EAAmC;AACjE,eAAKR,gBAAL,CAAsBG,IAAtB,CAA2BK,QAA3B;AACH;;AAEMI,QAAAA,8BAA8B,CAACJ,QAAD,EAAmC;AACpE,eAAKR,gBAAL,GAAwB,KAAKA,gBAAL,CAAsBa,MAAtB,CAA6BC,QAAQ,IAAIA,QAAQ,KAAKN,QAAtD,CAAxB;AACH;;AAEMO,QAAAA,KAAK,GAAS;AACjB,eAAKxB,WAAL,CAAiBC,MAAjB,GAA0B,CAA1B;AACH;;AAjF4E,O","sourcesContent":["import { Component, Node } from \"cc\";\r\n\r\nexport interface IObjectPool<T extends Component | Node> {\r\n    get(): T;\r\n    release(element: T): void;\r\n}\r\n\r\nexport class ObjectPooling<T extends Component | Node> implements IObjectPool<T> {\r\n    private createObject: () => T;\r\n    private initObject?: (obj: T) => void;\r\n    private recycleObject?: (obj: T) => void;\r\n\r\n    private onObjectAcquired: ((obj: T) => void)[] = [];\r\n    private objectQueue: T[] = [];\r\n\r\n    private maxSize: number;\r\n    get size(): number {\r\n        return this.objectQueue.length;\r\n    }\r\n\r\n    constructor(\r\n        createObject: () => T,\r\n        initObject?: (obj: T) => void,\r\n        recycleObject?: (obj: T) => void,\r\n        values?: T[],\r\n        initialSize: number = 10,\r\n        maxSize: number = 1000\r\n    ) {\r\n        if (!createObject) {\r\n            throw new Error(\"The createObject cannot be null\");\r\n        }\r\n\r\n        if (initialSize < 0) {\r\n            throw new Error(\"The initialSize cannot be negative\");\r\n        }\r\n\r\n        this.createObject = createObject;\r\n        this.initObject = initObject;\r\n        this.recycleObject = recycleObject;\r\n        this.maxSize = maxSize;\r\n\r\n        if (values) {\r\n            for (let value of values) {\r\n                this.objectQueue.push(value);\r\n            }\r\n        }\r\n    }\r\n\r\n    public get(): T {\r\n        let obj: T;\r\n\r\n        if (this.objectQueue.length === 0) {\r\n            obj = this.createObject();\r\n        } else {\r\n            obj = this.objectQueue.shift()!;\r\n        }\r\n\r\n        this.initObject?.(obj);\r\n        this.onObjectAcquired.forEach(callback => callback(obj));\r\n        return obj;\r\n    }\r\n\r\n    public release(obj: T): void {\r\n        if (!obj) {\r\n            throw new Error(\"Object cannot be null\");\r\n        }\r\n\r\n        if (this.objectQueue.indexOf(obj) !== -1) {\r\n            throw new Error(\"Problem while releasing object: Element which you want to release is already released.\");\r\n        }\r\n\r\n        if (this.size < this.maxSize) {\r\n            this.objectQueue.push(obj);\r\n        }\r\n\r\n        this.recycleObject?.(obj);\r\n    }\r\n\r\n    public addOnObjectAcquiredListener(callback: (obj: T) => void): void {\r\n        this.onObjectAcquired.push(callback);\r\n    }\r\n\r\n    public removeOnObjectAcquiredListener(callback: (obj: T) => void): void {\r\n        this.onObjectAcquired = this.onObjectAcquired.filter(listener => listener !== callback);\r\n    }\r\n\r\n    public clear(): void {\r\n        this.objectQueue.length = 0;\r\n    }\r\n}\r\n"]}