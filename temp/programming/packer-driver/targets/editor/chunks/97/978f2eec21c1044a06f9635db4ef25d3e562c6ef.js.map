{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/Grid/GridGenerator.ts"],"names":["_decorator","Component","Vec3","CCInteger","PiecesPool","InteractionManager","ccclass","property","GridGenerator","grid","PIECE_OFFSET","PIECE_CONTENT_SIZE","interactionManager","start","Generate","row","height","piece","createPiece","col","piecesPool","getPieceFromPool","setParent","node","createsMatch","setPosition","getCenteredPosition","addChild","name","returnPieceToPool","j","i","_j","_i"],"mappings":"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","sourcesContent":["import {\r\n  _decorator,\r\n  Component,\r\n  Node,\r\n  Vec3,\r\n  CCInteger,\r\n} from \"cc\";\r\nimport { PiecesPool } from \"../Poolable/PiecesPool\";\r\nimport { InteractionManager } from \"../Interaction/InteractionManager\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GridManager')\r\nexport class GridGenerator extends Component   {\r\n  public grid: Node[][] = [];\r\n\r\n  @property(PiecesPool)\r\n  private piecesPool: PiecesPool = null;\r\n  private PIECE_OFFSET: number = 5;\r\n\r\n  @property(CCInteger)\r\n  private width : number = 0;\r\n\r\n  @property(CCInteger)\r\n  private height : number = 0;\r\n\r\n  private PIECE_CONTENT_SIZE: number = 100; //dinamikleştir\r\n\r\n  private interactionManager: InteractionManager = new InteractionManager();\r\n\r\n  protected start(): void {\r\n    //!TODO: grid yerleşmesini ve content size'ı responsive yapmalıyız\r\n    // this.node.setPosition(-7*50, -500);\r\n    this.Generate();\r\n  }\r\n\r\n  public async Generate() {\r\n    for (let row = 0; row < this.height; row++) {\r\n      const piece = this.createPiece(row,0);\r\n    }\r\n\r\n    // for (let row = 0; row < this.GRID_ROW; row++) {\r\n    //   this.grid[row] = [];\r\n    //   const piecesInRow: PieceProps[] = [];\r\n    //   for (let col = 0; col < this.GRID_ROW; col++) {\r\n    //     const piece: Node = this.createPiece(row, col);\r\n    //     this.grid[row][col] = piece;\r\n    //     const pieceLastPosition = this.getCenteredPosition(col, row);\r\n    //     const pieceFirstPosition = new Vec3(\r\n    //       pieceLastPosition.x,\r\n    //       this.GRID_ROW * this.PIECE_CONTENT_SIZE\r\n    //     );\r\n    //     piece.setPosition(pieceFirstPosition);\r\n    //     //piecelere event listener ekliyoruz\r\n    //     // piece.on(Node.EventType.TOUCH_START, this.onPieceClicked, this);\r\n    //     piece.on(Node.EventType.TOUCH_START, (event: EventTouch) => {\r\n    //       this.interactionManager.onPieceClicked(event, piece , this.gridMap);\r\n    //     });\r\n    //     this.grid[row][col] = piece;\r\n\r\n    //     const pieceProps: PieceProps = {\r\n    //       piece: piece,\r\n    //       targetPosition: pieceLastPosition,\r\n    //     };\r\n    //     piecesInRow.push(pieceProps);\r\n    //   }\r\n    //   await EffectManager.animateRowFall(piecesInRow, 0.1);\r\n    // }\r\n  }\r\n\r\n  //bu fonksiyon init olurken match var mı diye kontrol edip piece üretiyor.\r\n  private createPiece(row: number, col: number): Node {\r\n    let piece: Node;\r\n    do {\r\n      piece = this.piecesPool.getPieceFromPool();\r\n      piece.setParent(this.node);\r\n    } while (this.createsMatch(piece, row, col, this.grid));\r\n    piece.setPosition(this.getCenteredPosition(col, row));\r\n    this.node.addChild(piece);\r\n    return piece;\r\n  }\r\n\r\n  private createsMatch(\r\n    piece: Node,\r\n    row: number,\r\n    col: number,\r\n    grid: Node[][]\r\n  ): boolean {\r\n    return false;\r\n    if (\r\n      row >= 2 &&\r\n      grid[row - 1][col]?.name === piece.name &&\r\n      grid[row - 2][col]?.name === piece.name\r\n    ) {\r\n      this.piecesPool.returnPieceToPool(piece);\r\n      return true;\r\n    }\r\n\r\n    if (\r\n      col >= 2 &&\r\n      grid[row][col - 1]?.name === piece.name &&\r\n      grid[row][col - 2]?.name === piece.name\r\n    ) {\r\n      this.piecesPool.returnPieceToPool(piece);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private getCenteredPosition(j: number, i: number): Vec3 {\r\n    //EVERY game board should be square matrix\r\n    const _j = j * (this.PIECE_CONTENT_SIZE + this.PIECE_OFFSET); //- ((this.PIECE_CONTENT_SIZE * 4.5))//(Math.round(this.GRID_ROW / 2))) )\r\n    const _i = i * (this.PIECE_CONTENT_SIZE + this.PIECE_OFFSET); //- ((this.PIECE_CONTENT_SIZE * 4.5))//(Math.round(this.GRID_ROW / 2))) )\r\n    return new Vec3(_j, _i);\r\n  }\r\n}\r\n"]}