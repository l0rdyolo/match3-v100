{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/Interaction/SelectionManager.ts"],"names":["_decorator","EventTarget","SingletonComponent","GridManager","ccclass","property","SelectionManager","eventTarget","firstSelected","secondSelected","onLoad","on","onPieceSelected","onDestroy","off","piece","handleFirstSelection","handleSecondSelection","applySelection","isEmpty","setSelection","isSelectionValid","getInstance","handleSelection","cancelSelection","rowDiff","Math","abs","row","colDiff","col"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAWC,MAAAA,W,OAAAA,W;;AAEXC,MAAAA,kB,iBAAAA,kB;;AACAC,MAAAA,W,iBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;kCAGjBM,gB,WADZF,OAAO,CAAC,kBAAD,C,gBAAR,MACaE,gBADb;AAAA;AAAA,oDAC2E;AAAA;AAAA;AAAA,eAClEC,WADkE,GACvC,IAAIN,WAAJ,EADuC;AAAA,eAGjEO,aAHiE,GAG1C,IAH0C;AAAA,eAIjEC,cAJiE,GAIzC,IAJyC;AAAA;;AAM/DC,QAAAA,MAAM,GAAS;AACvB,gBAAMA,MAAN;AACA,eAAKH,WAAL,CAAiBI,EAAjB,CACE,gBADF,EAEE,KAAKC,eAFP,EAGE,IAHF;AAKD;;AAESC,QAAAA,SAAS,GAAS;AAC1B,eAAKN,WAAL,CAAiBO,GAAjB,CACI,gBADJ,EAEI,KAAKF,eAFT,EAGI,IAHJ;AAKD;;AAEMA,QAAAA,eAAe,CAACG,KAAD,EAAqB;AACzC,cAAI,CAAC,KAAKP,aAAV,EAAyB;AACvB,iBAAKQ,oBAAL,CAA0BD,KAA1B;AACD,WAFD,MAEO;AACL,iBAAKE,qBAAL,CAA2BF,KAA3B;AACA,iBAAKG,cAAL;AACD;AAEF;;AAEDF,QAAAA,oBAAoB,CAACD,KAAD,EAAe;AACjC,cAAG,CAACA,KAAK,CAACI,OAAV,EAAmB;AACjB,iBAAKX,aAAL,GAAqBO,KAAK,CAACK,YAAN,EAArB;AACD;AACF;;AAEDH,QAAAA,qBAAqB,CAACF,KAAD,EAAe;AAClC,cAAG,CAACA,KAAK,CAACI,OAAV,EAAmB;AACjB,iBAAKV,cAAL,GAAsBM,KAAK,CAACK,YAAN,EAAtB;AACD;AACF;;AAEmB,cAAdF,cAAc,GAAI;AACtB,cAAI,KAAKG,gBAAL,EAAJ,EAA6B;AAC3B,kBAAM;AAAA;AAAA,4CAAYC,WAAZ,GAA0BC,eAA1B,CAA0C,KAAKf,aAA/C,EAA+D,KAAKC,cAApE,CAAN;AACD;;AACD,eAAKe,eAAL;AACH,SAlD0E,CAmD3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEEA,QAAAA,eAAe,GAAG;AAChB,eAAKhB,aAAL,GAAqB,KAAKA,aAAL,CAAmBgB,eAAnB,EAArB;AACA,eAAKf,cAAL,GAAsB,KAAKA,cAAL,CAAoBe,eAApB,EAAtB;AACD;;AAEMH,QAAAA,gBAAgB,GAAa;AAClC,cAAI,CAAC,KAAKb,aAAN,IAAuB,CAAC,KAAKC,cAAjC,EAAiD;AAC/C,iBAAKe,eAAL;AACE,mBAAO,KAAP;AACH;;AAED,gBAAMC,OAAO,GAAGC,IAAI,CAACC,GAAL,CAAS,KAAKnB,aAAL,CAAmBoB,GAAnB,GAAyB,KAAKnB,cAAL,CAAoBmB,GAAtD,CAAhB;AACA,gBAAMC,OAAO,GAAGH,IAAI,CAACC,GAAL,CAAS,KAAKnB,aAAL,CAAmBsB,GAAnB,GAAyB,KAAKrB,cAAL,CAAoBqB,GAAtD,CAAhB;AACA,iBAAQL,OAAO,KAAK,CAAZ,IAAiBI,OAAO,KAAK,CAA9B,IAAqCJ,OAAO,KAAK,CAAZ,IAAiBI,OAAO,KAAK,CAAzE;AACD;;AAhFwE,O","sourcesContent":["import { _decorator,EventTarget} from \"cc\";\r\nimport { Piece } from \"../Piece/Piece\";\r\nimport { SingletonComponent } from \"../SingletonComponent\";\r\nimport { GridManager } from \"../Grid/GridManager\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"SelectionManager\")\r\nexport class SelectionManager extends SingletonComponent<SelectionManager> {\r\n  public eventTarget: EventTarget = new EventTarget();\r\n\r\n  private firstSelected: Piece = null;\r\n  private secondSelected: Piece = null;\r\n\r\n  protected onLoad(): void {\r\n    super.onLoad();\r\n    this.eventTarget.on(\r\n      \"piece-selected\",\r\n      this.onPieceSelected,\r\n      this\r\n    );\r\n  }\r\n\r\n  protected onDestroy(): void {\r\n    this.eventTarget.off(\r\n        \"piece-selected\",\r\n        this.onPieceSelected,\r\n        this\r\n      );        \r\n  }\r\n\r\n  public onPieceSelected(piece: Piece): void {\r\n    if (!this.firstSelected) {\r\n      this.handleFirstSelection(piece);\r\n    } else {\r\n      this.handleSecondSelection(piece);\r\n      this.applySelection();\r\n    }\r\n    \r\n  }\r\n\r\n  handleFirstSelection(piece: Piece) {\r\n    if(!piece.isEmpty) {\r\n      this.firstSelected = piece.setSelection();\r\n    }\r\n  }\r\n\r\n  handleSecondSelection(piece: Piece) {\r\n    if(!piece.isEmpty) {\r\n      this.secondSelected = piece.setSelection();\r\n    }\r\n  }\r\n\r\n  async applySelection()  {\r\n    if (this.isSelectionValid()) {\r\n      await GridManager.getInstance().handleSelection(this.firstSelected , this.secondSelected);\r\n    }\r\n    this.cancelSelection();\r\n}\r\n//! IDEA - 2\r\n//   applySelection() : Piece[]{\r\n//     if (this.isSelectionValid()) {\r\n//       // await GridManager.getInstance().handleSelection(this.firstSelected , this.secondSelected);\r\n//       const pieceA = this.firstSelected;\r\n//       const pieceB = this.secondSelected\r\n//       this.cancelSelection();\r\n//       return [pieceA,pieceB]      \r\n//     } else {\r\n//         this.firstSelected.Shake();\r\n//         this.cancelSelection();\r\n//         return [];\r\n//     }\r\n// }\r\n\r\n  cancelSelection() {\r\n    this.firstSelected = this.firstSelected.cancelSelection();\r\n    this.secondSelected = this.secondSelected.cancelSelection();\r\n  }\r\n\r\n  public isSelectionValid() : boolean {\r\n    if (!this.firstSelected || !this.secondSelected) {\r\n      this.cancelSelection();\r\n        return false;\r\n    }\r\n\r\n    const rowDiff = Math.abs(this.firstSelected.row - this.secondSelected.row);\r\n    const colDiff = Math.abs(this.firstSelected.col - this.secondSelected.col);\r\n    return (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1);\r\n  }\r\n}\r\n\r\n"]}