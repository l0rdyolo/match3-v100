{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/Grid/GravityHandler.ts"],"names":["_decorator","Component","GridManager","ccclass","property","GravityHandler","applyGravity","matches","columnPieceCount","Map","piece","col","has","set","get","applyGravityToCol","count","row","gridManager","gridHeight","grid","newRow","updatePosition"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AAEZC,MAAAA,W,iBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;gCAGjBK,c,WADZF,OAAO,CAAC,gBAAD,C,UAGHC,QAAQ;AAAA;AAAA,qC,2BAHb,MACaC,cADb,SACoCJ,SADpC,CAC8C;AAAA;AAAA;;AAAA;AAAA;;AAK1CK,QAAAA,YAAY,CAACC,OAAD,EAAmB;AAC3B,gBAAMC,gBAAgB,GAAG,IAAIC,GAAJ,EAAzB;;AAEA,eAAK,MAAMC,KAAX,IAAoBH,OAApB,EAA6B;AACzB,kBAAMI,GAAG,GAAGD,KAAK,CAACC,GAAlB;;AACA,gBAAIH,gBAAgB,CAACI,GAAjB,CAAqBD,GAArB,CAAJ,EAA+B;AAC3BH,cAAAA,gBAAgB,CAACK,GAAjB,CAAqBF,GAArB,EAA0BH,gBAAgB,CAACM,GAAjB,CAAqBH,GAArB,IAA4B,CAAtD;AACH,aAFD,MAEO;AACHH,cAAAA,gBAAgB,CAACK,GAAjB,CAAqBF,GAArB,EAA0B,CAA1B;AACH;AACJ;;AAED,eAAKI,iBAAL,CAAuBP,gBAAvB;AACH;;AAEDO,QAAAA,iBAAiB,CAACP,gBAAD,EAAwC;AACrD,eAAK,MAAM,CAACG,GAAD,EAAMK,KAAN,CAAX,IAA2BR,gBAA3B,EAA6C;AACzC,iBAAK,IAAIS,GAAG,GAAG,KAAKC,WAAL,CAAiBC,UAAjB,GAA8B,CAA7C,EAAgDF,GAAG,IAAI,CAAvD,EAA0DA,GAAG,EAA7D,EAAiE;AAC7D,oBAAMP,KAAK,GAAG,KAAKQ,WAAL,CAAiBE,IAAjB,CAAsBH,GAAtB,EAA2BN,GAA3B,CAAd;AAEA,kBAAID,KAAK,KAAK,IAAd,EAAoB,SAHyC,CAG/B;;AAE9B,oBAAMW,MAAM,GAAGJ,GAAG,GAAGD,KAArB;;AAEA,kBAAIK,MAAM,GAAG,KAAKH,WAAL,CAAiBC,UAA9B,EAA0C;AACtC;AACA,qBAAKD,WAAL,CAAiBE,IAAjB,CAAsBC,MAAtB,EAA8BV,GAA9B,IAAqCD,KAArC;AACAA,gBAAAA,KAAK,CAACO,GAAN,GAAYI,MAAZ;AACAX,gBAAAA,KAAK,CAACY,cAAN,GAJsC,CAMtC;;AACA,qBAAKJ,WAAL,CAAiBE,IAAjB,CAAsBH,GAAtB,EAA2BN,GAA3B,IAAkC,IAAlC;AACH;AACJ;AACJ;AACJ;;AAxCyC,O;;;;;iBAGP,I","sourcesContent":["import { _decorator, Component, Node } from 'cc';\nimport { Piece } from '../Piece/Piece';\nimport { GridManager } from '../Grid/GridManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('GravityHandler')\nexport class GravityHandler extends Component {\n\n    @property(GridManager)\n    private gridManager: GridManager = null;\n\n    applyGravity(matches: Piece[]) {\n        const columnPieceCount = new Map<number, number>();\n\n        for (const piece of matches) {\n            const col = piece.col;\n            if (columnPieceCount.has(col)) {\n                columnPieceCount.set(col, columnPieceCount.get(col) + 1);\n            } else {\n                columnPieceCount.set(col, 1);\n            }\n        }\n\n        this.applyGravityToCol(columnPieceCount);\n    }\n\n    applyGravityToCol(columnPieceCount: Map<number, number>) {\n        for (const [col, count] of columnPieceCount) {\n            for (let row = this.gridManager.gridHeight - 1; row >= 0; row--) {\n                const piece = this.gridManager.grid[row][col];\n\n                if (piece === null) continue; // Eğer hücre boşsa, geç\n\n                const newRow = row + count;\n\n                if (newRow < this.gridManager.gridHeight) {\n                    // Parçayı yeni pozisyona taşı\n                    this.gridManager.grid[newRow][col] = piece;\n                    piece.row = newRow;\n                    piece.updatePosition();\n\n                    // Eski pozisyonu boşalt\n                    this.gridManager.grid[row][col] = null;\n                }\n            }\n        }\n    }\n}\n"]}