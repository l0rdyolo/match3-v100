{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/Grid/GridGenerator.ts"],"names":["_decorator","Component","CCInteger","Piece","PieceTypes","PiecePool","ccclass","property","GridGenerator","grid","Generate","row","width","col","height","piece","createPiece","pieceNode","getInstance","getPiece","console","error","Normal","init","node","setParent","addChild","createsMatch","createsMatchByName","isMatch","name","returnPiece"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, CCInteger } from \"cc\";\r\nimport { Piece } from \"../Piece/Piece\";\r\nimport { PieceTypes } from \"../Piece/PieceTypes\";\r\nimport { PiecePool } from \"../Piece/PiecePool\";\r\nimport { SelectionManager } from \"../Interaction/SelectionManager\";\r\nimport { IGrid } from \"./IGrid\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"GridGenerator\")\r\nexport class GridGenerator extends Component implements IGrid<Piece>{\r\n  public grid: Piece[][] = [];\r\n\r\n\r\n  @property(CCInteger)\r\n  public width: number = 0;\r\n\r\n  @property(CCInteger)\r\n  height: number = 0;\r\n\r\n  //! todo rowlari tweenleyebiliriz\r\n  public Generate() : Piece[][] {\r\n    for (let row = 0; row < this.width; row++) {\r\n      this.grid[row] = [];\r\n      for (let col = 0; col < this.height; col++) {\r\n        const piece = this.createPiece(row, col);\r\n        this.grid[row][col] = piece;\r\n      }\r\n    }\r\n    return this.grid;\r\n  }\r\n  private createPiece(row: number, col: number): Piece {\r\n    let pieceNode: Node | null;\r\n    let piece: Piece | null;\r\n    do {\r\n        pieceNode = PiecePool.getInstance().getPiece();\r\n        \r\n        if (!pieceNode) {\r\n            console.error(\"Piece could not be instantiated.\");\r\n            continue;\r\n        }\r\n        piece = new Piece(row, col, pieceNode, PieceTypes.Normal);\r\n        piece.init();\r\n        piece.node.setParent(this.node);\r\n        this.node.addChild(piece.node);\r\n    } while (this.createsMatch(piece, row, col, this.grid));\r\n\r\n    return piece!;\r\n}\r\n\r\nprivate createsMatchByName(\r\n  piece: Piece,\r\n  row: number,\r\n  col: number,\r\n  grid: Piece[][]\r\n): boolean {\r\n  let isMatch = false;\r\n  if (\r\n      row >= 2 &&\r\n      grid[row - 1][col]?.node.name === piece.node.name &&\r\n      grid[row - 2][col]?.node.name === piece.node.name\r\n  ) {\r\n      isMatch = true;\r\n  }\r\n\r\n  if (\r\n      col >= 2 &&\r\n      grid[row][col - 1]?.node.name === piece.node.name &&\r\n      grid[row][col - 2]?.node.name === piece.node.name\r\n  ) {\r\n      isMatch = true;\r\n  }\r\n  if(isMatch) PiecePool.getInstance().returnPiece(piece.node);\r\n  return isMatch;\r\n}\r\n\r\nprivate createsMatch(\r\n  piece: Piece,\r\n  row: number,\r\n  col: number,\r\n  grid: Piece[][]\r\n): boolean {\r\n  return this.createsMatchByName(piece, row, col, grid);\r\n}\r\n\r\n}\r\n"]}