{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/Grid/GravityHandler.ts"],"names":["_decorator","Component","GridManager","ccclass","property","GravityHandler","applyGravity","matches","columnPieceCount","Map","piece","col","has","set","get","applyGravityToCol","emptySpaces","applyGravityForSingleColumn","grid","getInstance","row","length","node","undefined","newRow","console","log","updatePosition"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AAEZC,MAAAA,W,iBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;gCAGjBK,c,WADZF,OAAO,CAAC,gBAAD,C,UAGHC,QAAQ;AAAA;AAAA,qC,2BAHb,MACaC,cADb,SACoCJ,SADpC,CAC8C;AAAA;AAAA;;AAAA;AAAA;;AAK1CK,QAAAA,YAAY,CAACC,OAAD,EAAmB;AAC3B,cAAMC,gBAAgB,GAAG,IAAIC,GAAJ,EAAzB,CAD2B,CAG3B;;AACA,eAAK,IAAMC,KAAX,IAAoBH,OAApB,EAA6B;AACzB,gBAAMI,GAAG,GAAGD,KAAK,CAACC,GAAlB;;AACA,gBAAIH,gBAAgB,CAACI,GAAjB,CAAqBD,GAArB,CAAJ,EAA+B;AAC3BH,cAAAA,gBAAgB,CAACK,GAAjB,CAAqBF,GAArB,EAA0BH,gBAAgB,CAACM,GAAjB,CAAqBH,GAArB,IAA4B,CAAtD;AACH,aAFD,MAEO;AACHH,cAAAA,gBAAgB,CAACK,GAAjB,CAAqBF,GAArB,EAA0B,CAA1B;AACH;AACJ;;AAED,eAAKI,iBAAL,CAAuBP,gBAAvB;AACH;;AAEDO,QAAAA,iBAAiB,CAACP,gBAAD,EAAwC;AACrD,eAAK,IAAM,CAACG,GAAD,EAAMK,WAAN,CAAX,IAAiCR,gBAAjC,EAAmD;AAC/C,iBAAKS,2BAAL,CAAiCN,GAAjC,EAAsCK,WAAtC;AACH;AACJ;;AAEDC,QAAAA,2BAA2B,CAACN,GAAD,EAAcK,WAAd,EAAmC;AAC1D,cAAME,IAAI,GAAG;AAAA;AAAA,0CAAYC,WAAZ,GAA0BD,IAAvC;;AAEA,eAAK,IAAIE,GAAG,GAAGF,IAAI,CAACG,MAAL,GAAc,CAA7B,EAAgCD,GAAG,IAAI,CAAvC,EAA0CA,GAAG,EAA7C,EAAiD;AAC7C,gBAAMV,KAAK,GAAGQ,IAAI,CAACE,GAAD,CAAJ,CAAUT,GAAV,CAAd;;AAEA,gBAAID,KAAK,CAACY,IAAN,KAAe,IAAf,IAAuBZ,KAAK,KAAKa,SAArC,EAAgD;AAC5C,kBAAMC,MAAM,GAAGJ,GAAG,GAAGJ,WAArB;;AAEA,kBAAIQ,MAAM,GAAGN,IAAI,CAACG,MAAlB,EAA0B;AACtBI,gBAAAA,OAAO,CAACC,GAAR,4BAAqCN,GAArC,eAAkDT,GAAlD,mBAAmEa,MAAnE,eAAmFb,GAAnF,QADsB,CAGtB;;AACAD,gBAAAA,KAAK,CAACiB,cAAN,CAAqBhB,GAArB,EAAyBS,GAAzB;AACAF,gBAAAA,IAAI,CAACM,MAAD,CAAJ,CAAab,GAAb,IAAoBD,KAApB;AACAA,gBAAAA,KAAK,CAACU,GAAN,GAAYI,MAAZ;AACAN,gBAAAA,IAAI,CAACE,GAAD,CAAJ,CAAUT,GAAV,IAAiB,IAAjB;AACH;AACJ;AACJ,WAnByD,CAqB1D;AACA;AACA;AACA;AACA;AACA;;AACH;;AAtDyC,O;;;;;iBAGP,I","sourcesContent":["import { _decorator, Component, Node } from 'cc';\nimport { Piece } from '../Piece/Piece';\nimport { GridManager } from '../Grid/GridManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('GravityHandler')\nexport class GravityHandler extends Component {\n\n    @property(GridManager)\n    private gridManager: GridManager = null;\n\n    applyGravity(matches: Piece[]) {\n        const columnPieceCount = new Map<number, number>();\n        \n        // Sütunlarda kaç adet boşluk oluştuğunu hesapla\n        for (const piece of matches) {\n            const col = piece.col;\n            if (columnPieceCount.has(col)) {\n                columnPieceCount.set(col, columnPieceCount.get(col) + 1);\n            } else {\n                columnPieceCount.set(col, 1);\n            }\n        }\n\n        this.applyGravityToCol(columnPieceCount);\n    }\n\n    applyGravityToCol(columnPieceCount: Map<number, number>) {\n        for (const [col, emptySpaces] of columnPieceCount) {\n            this.applyGravityForSingleColumn(col, emptySpaces);\n        }\n    }\n\n    applyGravityForSingleColumn(col: number, emptySpaces: number) {\n        const grid = GridManager.getInstance().grid;\n\n        for (let row = grid.length - 1; row >= 0; row--) {\n            const piece = grid[row][col];\n\n            if (piece.node !== null && piece !== undefined) {\n                const newRow = row + emptySpaces;\n\n                if (newRow < grid.length) {\n                    console.log(`Moving piece at (row: ${row}, col: ${col}) to (row: ${newRow}, col: ${col})`);\n\n                    // Parçayı yeni yerine taşı\n                    piece.updatePosition(col,row);\n                    grid[newRow][col] = piece;\n                    piece.row = newRow;\n                    grid[row][col] = null;\n                }\n            }\n        }\n\n        // Yeni parçalara yer açılması için boş kalan üst alanları doldur\n        // for (let i = 0; i < emptySpaces; i++) {\n        //     const newPiece = this.gridManager.createPiece(0, col);\n        //     grid[i][col] = newPiece;\n        //     console.log(`New piece created at (row: ${i}, col: ${col})`);\n        // }\n    }\n}\n"]}