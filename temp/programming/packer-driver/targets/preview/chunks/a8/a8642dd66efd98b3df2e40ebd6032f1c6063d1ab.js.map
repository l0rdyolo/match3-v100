{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/Piece/PiecePool.ts"],"names":["_decorator","Prefab","instantiate","SingletonComponent","ccclass","property","PiecePool","pool","initialPoolSize","start","fillPool","i","piece","createRandomPiece","push","prefab","getRandomPrefab","newPiece","active","node","addChild","setParent","piecesPrefabs","length","randomIndex","Math","floor","random","console","error","getPiece","shift","removeFromParent","log","returnPiece","clearAll","forEach","destroy"],"mappings":"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","sourcesContent":["import { _decorator, Prefab, instantiate, Node } from 'cc';\r\nimport { SingletonComponent } from '../SingletonComponent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PiecePool')\r\nexport class PiecePool extends SingletonComponent<PiecePool> {\r\n    @property([Prefab])\r\n    piecesPrefabs: Prefab[] = [];\r\n\r\n    public pool: Node[] = [];\r\n    private initialPoolSize: number = 500; //abartma\r\n    protected start(): void {\r\n        this.fillPool();\r\n    }\r\n\r\n    private fillPool(): void {\r\n        for (let i = 0; i < this.initialPoolSize; i++) {\r\n            const piece = this.createRandomPiece();\r\n            if (piece) {\r\n                this.pool.push(piece);\r\n            }\r\n        }\r\n    }\r\n\r\n    private createRandomPiece(): Node | null {\r\n        const prefab = this.getRandomPrefab();\r\n        if (prefab) {\r\n            const newPiece = instantiate(prefab);\r\n            newPiece.active = false;\r\n            this.node.addChild(newPiece);\r\n            newPiece.setParent(this.node);\r\n            return newPiece;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private getRandomPrefab(): Prefab | null {\r\n        if (this.piecesPrefabs.length > 0) {\r\n            const randomIndex = Math.floor(Math.random() * this.piecesPrefabs.length);\r\n            return this.piecesPrefabs[randomIndex];\r\n        } else {\r\n            console.error(\"No prefabs available in PiecePool.\");\r\n            return null;\r\n        }\r\n    }\r\n\r\n    public getPiece(): Node | null {\r\n        if (this.pool.length > 0) {\r\n            const piece = this.pool.shift();\r\n            piece.removeFromParent();\r\n            piece!.active = true; \r\n            return piece!;\r\n        } else {\r\n            console.log(\"Pool is empty, generating a new piece.\");\r\n            const newPiece = this.createRandomPiece();\r\n            if (newPiece) {\r\n                this.node.addChild(newPiece);\r\n                newPiece.setParent(this.node);\r\n                newPiece.active = true;\r\n                return newPiece;\r\n            } else {\r\n                console.error(\"Failed to create a new piece.\");\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n\r\n    public returnPiece(piece: Node) {\r\n        piece.removeFromParent();\r\n        piece.setParent(this.node);\r\n        this.node.addChild(piece);\r\n        piece.active = false; \r\n        this.pool.push(piece);\r\n    }\r\n\r\n    public clearAll() {\r\n        this.pool.forEach(piece => piece.destroy());\r\n        this.pool = [];\r\n    }\r\n}\r\n"]}