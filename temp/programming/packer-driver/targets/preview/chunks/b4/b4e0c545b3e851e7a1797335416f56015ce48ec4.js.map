{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/Interaction/SelectionManager.ts"],"names":["_decorator","EventTarget","SingletonComponent","EffectManager","ccclass","property","SelectionManager","eventTarget","firstSelected","secondSelected","onLoad","on","onPieceSelected","onDestroy","off","piece","handleFirstSelection","handleSecondSelection","Highlight","applySelection","isSelectionValid","console","log","swapPieces","Shake","cancelSelection","ResetScale","rowDiff","Math","abs","row","colDiff","col","pieceA","pieceB","posA","node","getPosition","posB","movePiece","checkMatches"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTarget, Node } from \"cc\";\nimport { Piece } from \"../Piece/Piece\";\nimport { SingletonComponent } from \"../SingletonComponent\";\nimport { EffectManager } from \"../Effects/EffectManager\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"SelectionManager\")\nexport class SelectionManager extends SingletonComponent<SelectionManager> {\n  public eventTarget: EventTarget = new EventTarget();\n\n  private firstSelected: Piece = null;\n  private secondSelected: Piece = null;\n\n  protected onLoad(): void {\n    super.onLoad();\n    this.eventTarget.on(\n      \"piece-selected\",\n      this.onPieceSelected,\n      this\n    );\n  }\n\n  protected onDestroy(): void {\n    this.eventTarget.off(\n        \"piece-selected\",\n        this.onPieceSelected,\n        this\n      );        \n  }\n\n  public onPieceSelected(piece: Piece): void {\n    if (!this.firstSelected) {\n      this.handleFirstSelection(piece);\n    } else {\n      this.handleSecondSelection(piece);\n    }\n  }\n\n  handleFirstSelection(piece: Piece) {\n    this.firstSelected = piece;\n    this.firstSelected.Highlight();\n  }\n\n  handleSecondSelection(piece: Piece) {\n    this.secondSelected = piece;\n    this.secondSelected.Highlight();\n    this.applySelection();\n  }\n\n  applySelection(){\n    if(this.isSelectionValid()){\n        //check Matches\n        console.log(\"abc\");\n        this.swapPieces(this.firstSelected,this.secondSelected);\n    }\n    else{\n        this.firstSelected.Shake();\n    }\n    this.cancelSelection();\n  }\n\n  cancelSelection() {\n    this.firstSelected.ResetScale();\n    this.secondSelected.ResetScale();\n    this.firstSelected = null;\n    this.secondSelected = null;\n  }\n\n  isSelectionValid() : boolean {\n    if (!this.firstSelected || !this.secondSelected) {\n        return false;\n    }\n\n    const rowDiff = Math.abs(this.firstSelected.row - this.secondSelected.row);\n    const colDiff = Math.abs(this.firstSelected.col - this.secondSelected.col);\n\n    return (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1);\n    return false;\n  }\n\n  swapPieces(pieceA : Piece , pieceB : Piece){\n    const posA = pieceA.node.getPosition();\n    const posB = pieceB.node.getPosition();\n\n    EffectManager.movePiece(pieceA.node , posB , 0.1)\n    EffectManager.movePiece(pieceB.node , posA , 0.1)\n  }\n\n  checkMatches(){\n    return false;\n  }\n}\n"]}