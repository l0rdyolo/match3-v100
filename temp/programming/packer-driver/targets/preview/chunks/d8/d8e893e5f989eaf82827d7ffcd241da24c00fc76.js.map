{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/SooLib/Joystick/DynamicJoystick.ts"],"names":["_decorator","Node","Vec3","BaseJoystick","JoystickObservable","ccclass","property","DynamicJoystick","joystickObservable","onTouchStart","event","touchId","touch","getID","touchPos","canvasResolver","resolvePosition","touchStartPos","set","ring","setPosition","stick","stickStartPos","getPosition","updateStickPosition","notifyStart","getDirection","onTouchMove","onTouchEnd","direction","notifyEnd","subscribe","observer","next","value","complete","error"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,I,OAAAA,I;AAAkBC,MAAAA,I,OAAAA,I;;AAC9BC,MAAAA,Y,iBAAAA,Y;;AACeC,MAAAA,kB,iBAAAA,kB;;;;;;;;;OAElB;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;iCAGjBO,e,WADZF,OAAO,CAAC,iBAAD,C,UAEHC,QAAQ,CAACL,IAAD,C,UAGRK,QAAQ,CAACL,IAAD,C,2BALb,MACaM,eADb;AAAA;AAAA,wCACwF;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAO5EC,kBAP4E,GAOnC;AAAA;AAAA,yDAPmC;AAAA;;AASpFC,QAAAA,YAAY,CAACC,KAAD,EAAoB;AAC5B,cAAI,KAAKC,OAAL,KAAiB,IAArB,EAA2B;AACvB,gBAAMC,KAAK,GAAGF,KAAK,CAACE,KAApB;AACA,iBAAKD,OAAL,GAAeC,KAAK,CAACC,KAAN,EAAf;AACA,gBAAIC,QAAQ,GAAG,KAAKC,cAAL,CAAoBC,eAApB,CAAoCN,KAApC,CAAf;AACA,iBAAKO,aAAL,CAAmBC,GAAnB,CAAuBJ,QAAvB;AAEA,iBAAKK,IAAL,CAAUC,WAAV,CAAsB,KAAKH,aAA3B;AACA,iBAAKI,KAAL,CAAWD,WAAX,CAAuB,KAAKH,aAA5B;AACA,iBAAKK,aAAL,CAAmBJ,GAAnB,CAAuB,KAAKG,KAAL,CAAWE,WAAX,EAAvB;AAEA,iBAAKC,mBAAL,CAAyBd,KAAzB;AACA,iBAAKF,kBAAL,CAAwBiB,WAAxB,CAAoC,KAAKC,YAAL,EAApC,EAAyD;AAAEP,cAAAA,IAAI,EAAE,KAAKA,IAAb;AAAmBE,cAAAA,KAAK,EAAE,KAAKA;AAA/B,aAAzD;AACH;AACJ;;AAEDM,QAAAA,WAAW,CAACjB,KAAD,EAAoB;AAC3B,cAAI,KAAKC,OAAL,KAAiB,IAAjB,IAAyBD,KAAK,CAACE,KAAN,CAAYC,KAAZ,OAAwB,KAAKF,OAA1D,EAAmE;AAC/D,iBAAKa,mBAAL,CAAyBd,KAAzB;AACH;AACJ;;AAEDkB,QAAAA,UAAU,CAAClB,KAAD,EAAoB;AAC1B,cAAIA,KAAK,CAACE,KAAN,CAAYC,KAAZ,OAAwB,KAAKF,OAAjC,EAA0C;AACtC,iBAAKA,OAAL,GAAe,IAAf;AACA,iBAAKkB,SAAL,CAAeX,GAAf,CAAmB,IAAIhB,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,CAAnB;AACA,iBAAKM,kBAAL,CAAwBsB,SAAxB,CAAkC,KAAKJ,YAAL,EAAlC,EAAuD;AAAEP,cAAAA,IAAI,EAAE,KAAKA,IAAb;AAAmBE,cAAAA,KAAK,EAAE,KAAKA;AAA/B,aAAvD;AACH;AACJ;;AAEDK,QAAAA,YAAY,GAAS;AACjB,iBAAO,KAAKG,SAAZ;AACH,SAzCmF,CA2CpF;;;AACAE,QAAAA,SAAS,CAACC,QAAD,EAA2C;AAChD,eAAKxB,kBAAL,CAAwBuB,SAAxB,CAAkCC,QAAlC;AACH;;AAEDC,QAAAA,IAAI,CAACC,KAAD,EAA6B;AAC7B,eAAK1B,kBAAL,CAAwByB,IAAxB,CAA6BC,KAA7B;AACH;;AAEDC,QAAAA,QAAQ,GAAS;AACb,eAAK3B,kBAAL,CAAwB2B,QAAxB;AACH;;AAEDC,QAAAA,KAAK,CAACA,KAAD,EAAqB;AACtB,eAAK5B,kBAAL,CAAwB4B,KAAxB,CAA8BA,KAA9B;AACH;;AA1DmF,O;;;;;iBAE5D,I;;;;;;;iBAGD,I","sourcesContent":["import { _decorator, Node, EventTouch, Vec3, UITransform } from \"cc\";\nimport { BaseJoystick } from \"./BaseJoystick\";\nimport { JoystickEvent, JoystickObservable } from \"./JoystickObservable\";\nimport { IObservable, IObserver } from \"../Runtime/Observer\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"DynamicJoystick\")\nexport class DynamicJoystick extends BaseJoystick implements IObservable<JoystickEvent> {\n    @property(Node)\n    protected stick: Node = null;\n\n    @property(Node)\n    protected ring: Node = null;\n\n    private joystickObservable: JoystickObservable = new JoystickObservable();\n\n    onTouchStart(event: EventTouch) {\n        if (this.touchId === null) {\n            const touch = event.touch;\n            this.touchId = touch.getID();\n            let touchPos = this.canvasResolver.resolvePosition(event);\n            this.touchStartPos.set(touchPos);\n\n            this.ring.setPosition(this.touchStartPos);\n            this.stick.setPosition(this.touchStartPos);\n            this.stickStartPos.set(this.stick.getPosition());\n\n            this.updateStickPosition(event);\n            this.joystickObservable.notifyStart(this.getDirection(), { ring: this.ring, stick: this.stick });\n        }\n    }\n\n    onTouchMove(event: EventTouch) {\n        if (this.touchId !== null && event.touch.getID() === this.touchId) {\n            this.updateStickPosition(event);\n        }\n    }\n\n    onTouchEnd(event: EventTouch) {\n        if (event.touch.getID() === this.touchId) {\n            this.touchId = null;\n            this.direction.set(new Vec3(0, 0, 0));\n            this.joystickObservable.notifyEnd(this.getDirection(), { ring: this.ring, stick: this.stick });\n        }\n    }\n\n    getDirection(): Vec3 {\n        return this.direction;\n    }\n\n    ///< Observable events\n    subscribe(observer: IObserver<JoystickEvent>): void {\n        this.joystickObservable.subscribe(observer);\n    }\n\n    next(value: JoystickEvent): void {\n        this.joystickObservable.next(value);\n    }\n\n    complete(): void {\n        this.joystickObservable.complete();\n    }\n\n    error(error: Error): void {\n        this.joystickObservable.error(error);\n    }\n}\n"]}