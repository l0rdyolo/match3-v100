{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/SooLib/Joystick/BaseJoystick.ts"],"names":["BaseJoystick","Component","Node","UITransform","Vec3","CanvasResolver","TouchEvents","stick","ring","touchStartPos","stickStartPos","touchId","radius","direction","isDynamic","touchEvents","canvasResolver","onLoad","getComponent","width","node","addComponent","register","EventType","TOUCH_START","onTouchStart","bind","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","onDestroy","unregisterAll","updateStickPosition","event","touchPos","resolvePosition","delta","subtract","distance","length","normalize","multiplyScalar","newPos","add","setPosition","set","x","y"],"mappings":"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","sourcesContent":["import { Component, EventTouch, Node, UITransform, Vec3 } from \"cc\";\nimport { IJoystick } from \"./IJoystick\";\nimport { CanvasResolver } from \"./CanvasResolver\";\nimport { TouchEvents } from \"./TouchEvents\";\n\nexport abstract class BaseJoystick extends Component implements IJoystick {\n    protected stick: Node;\n    protected ring: Node;\n    protected touchStartPos: Vec3 = new Vec3();\n    protected stickStartPos: Vec3 = new Vec3();\n    protected touchId: number = null;\n    protected radius: number = 0;\n    protected direction: Vec3 = new Vec3();\n    protected isDynamic: boolean = true;\n    protected touchEvents: TouchEvents;\n    protected canvasResolver: CanvasResolver;\n\n    abstract onTouchStart(event: EventTouch): void;\n    abstract onTouchMove(event: EventTouch): void;\n    abstract onTouchEnd(event: EventTouch): void;\n    abstract getDirection(): Vec3;\n\n    protected onLoad() {\n        this.radius = this.ring.getComponent(UITransform).width / 2;\n        this.canvasResolver = this.node.getComponent(CanvasResolver);\n        if (!this.canvasResolver) {\n            this.canvasResolver = this.node.addComponent(CanvasResolver);\n        }\n\n        this.touchEvents = new TouchEvents(this.node);\n        this.touchEvents.register([\n            [Node.EventType.TOUCH_START, this.onTouchStart.bind(this)],\n            [Node.EventType.TOUCH_MOVE, this.onTouchMove.bind(this)],\n            [Node.EventType.TOUCH_END, this.onTouchEnd.bind(this)],\n            [Node.EventType.TOUCH_CANCEL, this.onTouchEnd.bind(this)]\n        ]);\n    }\n\n    protected onDestroy() {\n        this.touchEvents.unregisterAll();\n    }\n\n    protected updateStickPosition(event: EventTouch) {\n        let touchPos = this.canvasResolver.resolvePosition(event);\n        let delta = Vec3.subtract(new Vec3(), touchPos, this.touchStartPos);\n        const distance = delta.length();\n        const radius = this.radius;\n\n        if (distance > radius) {\n            delta = delta.normalize().multiplyScalar(radius);\n        }\n\n        const newPos = Vec3.add(new Vec3(), this.touchStartPos, delta);\n        this.stick.setPosition(newPos);\n        this.direction.set(delta.x / radius, delta.y / radius, 0);\n    }\n}\n"]}