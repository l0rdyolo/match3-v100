{"version":3,"sources":["file:///C:/Users/maide/OneDrive/Documents/GitHub/match3-v100/assets/Scripts/Grid/GravityHandler.ts"],"names":["_decorator","Component","Vec3","ccclass","property","GravityHandler","onLoad","applyGravity","grid","moved","promises","emptyPieces","col","length","row","currentPiece","belowPiece","isEmpty","indexOf","push","moveToPosition","Promise","all"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;;;;;;;;;OAI1B;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;gCAGjBK,c,WADZF,OAAO,CAAC,gBAAD,C,gBAAR,MACaE,cADb,SACoCJ,SADpC,CAC8C;AAC5CK,QAAAA,MAAM,GAAG;AACP,gBAAMA,MAAN;AACD,SAH2C,CAK5C;;;AACMC,QAAAA,YAAY,CAACC,IAAD,EAAO;AAAA;AACvB,gBAAIC,KAAK,GAAG,KAAZ;AACA,gBAAIC,QAAyB,GAAG,EAAhC;AACA,gBAAIC,WAAoB,GAAG,EAA3B;;AACA,eAAG;AACDF,cAAAA,KAAK,GAAG,KAAR;;AAEA,mBAAK,IAAIG,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGJ,IAAI,CAAC,CAAD,CAAJ,CAAQK,MAAhC,EAAwCD,GAAG,EAA3C,EAA+C;AAC7C,qBAAK,IAAIE,GAAG,GAAGN,IAAI,CAACK,MAAL,GAAc,CAA7B,EAAgCC,GAAG,IAAI,CAAvC,EAA0CA,GAAG,EAA7C,EAAiD;AAC/C,sBAAMC,YAAY,GAAGP,IAAI,CAACM,GAAD,CAAJ,CAAUF,GAAV,CAArB;AACA,sBAAMI,UAAU,GAAGR,IAAI,CAACM,GAAG,GAAG,CAAP,CAAJ,CAAcF,GAAd,CAAnB;;AAEA,sBAAIG,YAAY,CAACE,OAAb,IAAwB,CAACD,UAAU,CAACC,OAAxC,EAAiD;AAC/CT,oBAAAA,IAAI,CAACM,GAAD,CAAJ,CAAUF,GAAV,IAAiBI,UAAjB;AACAR,oBAAAA,IAAI,CAACM,GAAG,GAAG,CAAP,CAAJ,CAAcF,GAAd,IAAqBG,YAArB;AAEAC,oBAAAA,UAAU,CAACJ,GAAX,GAAiBG,YAAY,CAACH,GAA9B;AACAI,oBAAAA,UAAU,CAACF,GAAX,GAAiBC,YAAY,CAACD,GAA9B;;AAEA,wBAAIH,WAAW,CAACO,OAAZ,CAAoBH,YAApB,MAAsC,CAAC,CAA3C,EAA8C;AAC5CJ,sBAAAA,WAAW,CAACQ,IAAZ,CAAiBJ,YAAjB;AACD;;AACDL,oBAAAA,QAAQ,CAACS,IAAT,CAAcH,UAAU,CAACI,cAAX,CAA0B,IAAIlB,IAAJ,CAASU,GAAT,EAAcE,GAAd,EAAmB,CAAnB,CAA1B,CAAd;AACAL,oBAAAA,KAAK,GAAG,IAAR;AACD;AACF;AACF;;AACD,oBAAMY,OAAO,CAACC,GAAR,CAAYZ,QAAZ,CAAN;AACD,aAxBD,QAwBSD,KAxBT;;AAyBA,mBAAOE,WAAP;AA7BuB;AA8BxB;;AApC2C,O","sourcesContent":["import { _decorator, Component, Vec3 } from \"cc\";\nimport { SingletonComponent } from \"../SingletonComponent\";\nimport { GridManager } from \"./GridManager\";\nimport { Piece } from \"../Piece/Piece\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"GravityHandler\")\nexport class GravityHandler extends Component {\n  onLoad() {\n    super.onLoad();\n  }\n\n  //! IDEA - burada patlÄ±yoruz\n  async applyGravity(grid) {\n    let moved = false;\n    let promises: Promise<void>[] = [];\n    let emptyPieces: Piece[] = [];\n    do {\n      moved = false;\n\n      for (let col = 0; col < grid[0].length; col++) {\n        for (let row = grid.length - 2; row >= 0; row--) { \n          const currentPiece = grid[row][col];\n          const belowPiece = grid[row + 1][col];\n\n          if (currentPiece.isEmpty && !belowPiece.isEmpty) { \n            grid[row][col] = belowPiece;\n            grid[row + 1][col] = currentPiece;\n\n            belowPiece.col = currentPiece.col;\n            belowPiece.row = currentPiece.row;\n\n            if (emptyPieces.indexOf(currentPiece) === -1) {\n              emptyPieces.push(currentPiece);\n            }\n            promises.push(belowPiece.moveToPosition(new Vec3(col, row, 0)));\n            moved = true;\n          }\n        }\n      }\n      await Promise.all(promises);\n    } while (moved); \n    return emptyPieces;\n  }\n}\n"]}